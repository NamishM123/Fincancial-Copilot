<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Copilot - AI Powered</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .user-info {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .logout-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            margin-left: 10px;
        }

        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .auth-toggle {
            display: flex;
            margin-bottom: 20px;
        }

        .auth-toggle button {
            flex: 1;
            padding: 10px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px 0 0 5px;
        }

        .auth-toggle button:last-child {
            border-radius: 0 5px 5px 0;
        }

        .auth-toggle button.active {
            background: #667eea;
            color: white;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .balance-card {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .balance-card h3 {
            color: white;
        }

        .balance-amount {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .transaction-item:hover {
            background: #e9ecef;
        }

        .transaction-info {
            flex-grow: 1;
        }

        .transaction-description {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .transaction-category {
            font-size: 0.9em;
            color: #666;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1em;
        }

        .income {
            color: #4CAF50;
        }

        .expense {
            color: #f44336;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .ai-chat {
            background: linear-gradient(135deg, #ff9a56, #ff6b6b);
            color: white;
        }

        .ai-chat h3 {
            color: white;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
        }

        .message.user {
            background: rgba(255,255,255,0.3);
            margin-left: auto;
        }

        .message.ai {
            background: rgba(255,255,255,0.2);
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .chat-input input::placeholder {
            color: rgba(255,255,255,0.8);
        }

        .chat-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 20px;
            cursor: pointer;
        }

        .insights {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .insights h3 {
            color: white;
        }

        .insight-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            backdrop-filter: blur(5px);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .balance-amount {
                font-size: 2em;
            }

            .user-info {
                position: static;
                margin-top: 15px;
                text-align: center;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="authSection" class="auth-container">
        <div class="auth-toggle">
            <button id="loginTab" class="active" onclick="switchTab('login')">Login</button>
            <button id="registerTab" onclick="switchTab('register')">Register</button>
        </div>

        <!-- Login Form -->
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required placeholder="your@email.com" value="demo@example.com">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required placeholder="Password" value="password123">
            </div>
            <button type="submit" class="btn" id="loginBtn">Login</button>
            <p style="margin-top: 15px; text-align: center; color: #666; font-size: 0.9em;">
                Demo credentials are pre-filled. Click Login to continue.
            </p>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="hidden">
            <div class="form-group">
                <label for="registerUsername">Username</label>
                <input type="text" id="registerUsername" required placeholder="Your name" minlength="2">
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required placeholder="Create password (min 6 chars)" minlength="6">
            </div>
            <button type="submit" class="btn" id="registerBtn">Register</button>
            <p style="margin-top: 15px; text-align: center; color: #666; font-size: 0.9em;">
                Create a new account to get started with Finance Copilot AI!
            </p>
        </form>
    </div>

    <!-- Main Application -->
    <div id="appSection" class="hidden">
        <div class="container">
            <div class="header">
                <h1>ðŸ’° Finance Copilot AI</h1>
                <p>Your AI-Powered Personal Finance Assistant</p>
                <div class="user-info">
                    <span id="userWelcome">Welcome!</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="dashboard">
                <!-- Balance Card -->
                <div class="card balance-card">
                    <h3>ðŸ’³ Current Balance</h3>
                    <div class="balance-amount" id="balance">$0.00</div>
                    <p>Total across all accounts</p>
                </div>

                <!-- Add Transaction -->
                <div class="card">
                    <h3>âž• Add Transaction</h3>
                    <div class="auth-toggle" style="margin-bottom: 15px;">
                        <button type="button" id="manualTab" class="active" onclick="switchTransactionTab('manual')">Manual Entry</button>
                        <button type="button" id="uploadTab" onclick="switchTransactionTab('upload')">Upload File</button>
                    </div>
                    
                    <!-- Manual Entry Form -->
                    <form id="transactionForm">
                        <div class="form-group">
                            <label for="description">Description</label>
                            <input type="text" id="description" required placeholder="Coffee, Salary, etc.">
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount ($)</label>
                            <input type="number" id="amount" step="0.01" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="type">Type</label>
                            <select id="type" required>
                                <option value="">Select type</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category" required>
                                <option value="">Select category</option>
                            </select>
                        </div>
                        <button type="submit" class="btn" id="addTransactionBtn">Add Transaction</button>
                    </form>

                    <!-- File Upload Form -->
                    <div id="uploadForm" class="hidden">
                        <div class="form-group">
                            <label for="transactionFile">Upload CSV/Excel File</label>
                            <input type="file" id="transactionFile" accept=".csv,.xlsx,.xls" style="padding: 8px; border: 2px dashed #667eea;">
                            <small style="color: #666; display: block; margin-top: 5px;">
                                Supported formats: CSV, Excel (.xlsx, .xls)<br>
                                Required columns: Description, Amount, Type, Category, Date
                            </small>
                        </div>
                        <button type="button" class="btn" id="uploadTransactionBtn" onclick="uploadTransactions()">Upload Transactions</button>
                        
                        <!-- Sample template download -->
                        <div style="margin-top: 15px; text-align: center;">
                            <button type="button" class="btn" onclick="downloadTemplate()" style="background: #28a745; width: auto; padding: 8px 16px; font-size: 14px;">
                                ðŸ“„ Download Sample Template
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card">
                    <h3>ðŸ“Š Recent Transactions</h3>
                    <div class="transaction-list" id="transactionList">
                        <p style="text-align: center; color: #666; padding: 20px;">Loading transactions...</p>
                    </div>
                </div>

                <!-- AI Chat Assistant -->
                <div class="card ai-chat">
                    <h3>ðŸ¤– AI Financial Advisor</h3>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <strong>AI Assistant:</strong><br>
                            Hello! I'm your AI financial advisor. Ask me anything about your finances, like "How can I save more money?" or "What should I budget for food?"
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Ask about your finances..." onkeypress="if(event.key==='Enter') sendMessage()">
                        <button class="chat-btn" onclick="sendMessage()" id="chatBtn">Send</button>
                    </div>
                </div>

                <!-- Smart Insights -->
                <div class="card insights">
                    <h3>ðŸŽ¯ Smart Insights</h3>
                    <div id="insightsList">
                        <div class="insight-item">
                            <strong>Loading insights...</strong><br>
                            Please wait while we analyze your financial data.
                        </div>
                    </div>
                </div>

                <!-- Spending Chart -->
                <div class="card">
                    <h3>ðŸ“ˆ Spending by Category</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global functions - defined at the very top
        function switchTab(tab) {
            console.log('switchTab called with:', tab);
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            if (loginTab && registerTab && loginForm && registerForm) {
                if (tab === 'login') {
                    loginTab.classList.add('active');
                    registerTab.classList.remove('active');
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                } else if (tab === 'register') {
                    registerTab.classList.add('active');
                    loginTab.classList.remove('active');
                    registerForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                }
            } else {
                console.error('Elements not found for tab switching');
            }
        }

        function switchTransactionTab(tab) {
            const manualTab = document.getElementById('manualTab');
            const uploadTab = document.getElementById('uploadTab');
            const transactionForm = document.getElementById('transactionForm');
            const uploadForm = document.getElementById('uploadForm');

            if (tab === 'manual') {
                manualTab.classList.add('active');
                uploadTab.classList.remove('active');
                transactionForm.classList.remove('hidden');
                uploadForm.classList.add('hidden');
            } else if (tab === 'upload') {
                uploadTab.classList.add('active');
                manualTab.classList.remove('active');
                uploadForm.classList.remove('hidden');
                transactionForm.classList.add('hidden');
            }
        }

        function uploadTransactions() {
            if (window.financeApp) {
                window.financeApp.uploadTransactions();
            }
        }

        function downloadTemplate() {
            if (window.financeApp) {
                window.financeApp.downloadTemplate();
            }
        }

        function logout() {
            if (window.financeApp) {
                window.financeApp.logout();
            }
        }

        function sendMessage() {
            if (window.financeApp) {
                window.financeApp.sendMessage();
            }
        }

        class AIFinanceCopilot {
            constructor() {
                this.user = JSON.parse(localStorage.getItem('user') || '{}');
                this.transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                this.categories = {
                    income: ['Salary', 'Freelance', 'Investments', 'Other Income'],
                    expense: ['Food', 'Transportation', 'Entertainment', 'Utilities', 'Shopping', 'Healthcare', 'Education', 'Other']
                };
                this.charts = {};
                this.isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                this.init();
            }

            init() {
                if (this.isLoggedIn && this.user.username) {
                    this.showApp();
                    this.loadUserData();
                } else {
                    this.showAuth();
                }
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Auth forms
                const loginForm = document.getElementById('loginForm');
                const registerForm = document.getElementById('registerForm');
                
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.login();
                    });
                }

                if (registerForm) {
                    registerForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.register();
                    });
                }

                // Transaction form
                const transactionForm = document.getElementById('transactionForm');
                if (transactionForm) {
                    transactionForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addTransaction();
                    });
                }

                const typeSelect = document.getElementById('type');
                if (typeSelect) {
                    typeSelect.addEventListener('change', (e) => {
                        this.updateCategoryOptions(e.target.value);
                    });
                }
            }

            login() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const btn = document.getElementById('loginBtn');

                btn.disabled = true;
                btn.textContent = 'Logging in...';

                // Simulate login delay
                setTimeout(() => {
                    // Simple demo login - accept any email/password
                    this.user = {
                        id: 1,
                        username: email.split('@')[0],
                        email: email
                    };
                    
                    localStorage.setItem('user', JSON.stringify(this.user));
                    localStorage.setItem('isLoggedIn', 'true');
                    this.isLoggedIn = true;
                    
                    this.showNotification('Login successful! ðŸŽ‰', 'success');
                    this.showApp();
                    this.loadUserData();
                    
                    btn.disabled = false;
                    btn.textContent = 'Login';
                }, 1000);
            }

            register() {
                const username = document.getElementById('registerUsername').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const btn = document.getElementById('registerBtn');

                // Validate inputs
                if (!username || !email || !password) {
                    this.showNotification('Please fill in all fields', 'error');
                    return;
                }

                if (password.length < 6) {
                    this.showNotification('Password must be at least 6 characters', 'error');
                    return;
                }

                btn.disabled = true;
                btn.textContent = 'Creating account...';

                // Simulate registration delay
                setTimeout(() => {
                    this.user = {
                        id: Date.now(),
                        username: username,
                        email: email
                    };
                    
                    localStorage.setItem('user', JSON.stringify(this.user));
                    localStorage.setItem('isLoggedIn', 'true');
                    this.isLoggedIn = true;
                    
                    this.showNotification('Account created successfully! ðŸŽ‰', 'success');
                    this.showApp();
                    this.loadUserData();
                    
                    btn.disabled = false;
                    btn.textContent = 'Register';
                }, 1000);
            }

            logout() {
                localStorage.removeItem('user');
                localStorage.removeItem('isLoggedIn');
                this.isLoggedIn = false;
                this.user = {};
                this.transactions = [];
                this.showAuth();
                this.showNotification('Logged out successfully', 'success');
            }

            showAuth() {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('appSection').classList.add('hidden');
            }

            showApp() {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('appSection').classList.remove('hidden');
                document.getElementById('userWelcome').textContent = `Welcome, ${this.user.username}!`;
            }

            loadUserData() {
                this.loadTransactions();
                this.loadBalance();
                this.setupCharts();
                this.generateInsights();
            }

            loadTransactions() {
                this.updateTransactionList();
                this.updateCharts();
            }

            loadBalance() {
                const balance = this.transactions.reduce((total, transaction) => {
                    return transaction.type === 'income' 
                        ? total + transaction.amount 
                        : total - transaction.amount;
                }, 0);
                
                document.getElementById('balance').textContent = this.formatCurrency(balance);
            }

            addTransaction() {
                const description = document.getElementById('description').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const type = document.getElementById('type').value;
                const category = document.getElementById('category').value;
                const date = new Date().toISOString().split('T')[0];
                const btn = document.getElementById('addTransactionBtn');

                btn.disabled = true;
                btn.textContent = 'Adding...';

                const transaction = {
                    id: Date.now(),
                    description,
                    amount,
                    type,
                    category,
                    date,
                    userId: this.user.id
                };

                this.transactions.unshift(transaction);
                localStorage.setItem('transactions', JSON.stringify(this.transactions));

                setTimeout(() => {
                    this.showNotification('Transaction added successfully! ðŸ’°', 'success');
                    document.getElementById('transactionForm').reset();
                    this.updateCategoryOptions('');
                    this.loadUserData();
                    
                    btn.disabled = false;
                    btn.textContent = 'Add Transaction';
                }, 500);
            }

            updateCategoryOptions(type) {
                const categorySelect = document.getElementById('category');
                categorySelect.innerHTML = '<option value="">Select category</option>';
                
                if (type && this.categories[type]) {
                    this.categories[type].forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                }
            }

            updateTransactionList() {
                const container = document.getElementById('transactionList');
                
                if (this.transactions.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No transactions yet. Add your first transaction!</p>';
                    return;
                }

                container.innerHTML = this.transactions.slice(0, 10).map(transaction => `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-description">${transaction.description}</div>
                            <div class="transaction-category">${transaction.category} â€¢ ${transaction.date}</div>
                        </div>
                        <div class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'income' ? '+' : '-'}${this.formatCurrency(Math.abs(transaction.amount))}
                        </div>
                    </div>
                `).join('');
            }

            setupCharts() {
                this.setupCategoryChart();
            }

            setupCategoryChart() {
                const ctx = document.getElementById('categoryChart').getContext('2d');
                
                if (this.charts.category) {
                    this.charts.category.destroy();
                }

                this.charts.category = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });

                this.updateCharts();
            }

            updateCharts() {
                const expensesByCategory = {};
                this.transactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
                    });

                const categories = Object.keys(expensesByCategory);
                const amounts = Object.values(expensesByCategory);

                if (this.charts.category && categories.length > 0) {
                    this.charts.category.data.labels = categories;
                    this.charts.category.data.datasets[0].data = amounts;
                    this.charts.category.update();
                }
            }

            sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                const btn = document.getElementById('chatBtn');

                if (!message) return;

                // Add user message
                this.addChatMessage(message, 'user');
                input.value = '';
                
                btn.disabled = true;
                btn.innerHTML = '<div class="loading"></div>';

                // Generate intelligent AI response
                setTimeout(() => {
                    const response = this.generateAIResponse(message);
                    this.addChatMessage(response, 'ai');
                    
                    btn.disabled = false;
                    btn.textContent = 'Send';
                }, 1000);
            }

            generateAIResponse(userMessage) {
                const msg = userMessage.toLowerCase();
                const balance = this.transactions.reduce((total, t) => 
                    t.type === 'income' ? total + t.amount : total - t.amount, 0);
                
                const monthlyIncome = this.getMonthlyIncome();
                const monthlyExpenses = this.getMonthlyExpenses();
                const topExpenseCategory = this.getTopExpenseCategory();

                // Analyze user intent and provide contextual advice
                if (msg.includes('save') || msg.includes('saving')) {
                    if (monthlyIncome > monthlyExpenses) {
                        const savingsRate = ((monthlyIncome - monthlyExpenses) / monthlyIncome * 100).toFixed(1);
                        return `Great question! You're currently saving ${this.formatCurrency(monthlyIncome - monthlyExpenses)} monthly (${savingsRate}% savings rate). To save more, try the 50/30/20 rule: 50% needs, 30% wants, 20% savings. Consider automating your savings and reviewing your ${topExpenseCategory} expenses which seem to be your largest category.`;
                    } else {
                        return `I see you're spending more than you earn currently. Start by tracking every expense for a week, then identify 3 non-essential expenses you can cut. Even saving $50-100/month is a great start! Focus on building a $1000 emergency fund first.`;
                    }
                }
                
                if (msg.includes('budget') || msg.includes('spend')) {
                    const expenseBreakdown = this.getExpenseBreakdown();
                    return `Based on your spending data: Your top expense is ${topExpenseCategory} at ${this.formatCurrency(expenseBreakdown[topExpenseCategory] || 0)}/month. For a balanced budget, consider: Housing (25-30%), Food (10-15%), Transportation (10-20%). Your current monthly expenses are ${this.formatCurrency(monthlyExpenses)}.`;
                }
                
                if (msg.includes('invest') || msg.includes('retirement')) {
                    if (balance > 1000) {
                        return `With your current balance of ${this.formatCurrency(balance)}, you're ready to consider investing! Start with: 1) Max out any employer 401k match, 2) Build 3-6 months emergency fund, 3) Consider low-cost index funds (S&P 500). Start with 10-15% of income if possible.`;
                    } else {
                        return `Before investing, focus on: 1) Building a $1000 emergency fund, 2) Paying off high-interest debt, 3) Stabilizing your income. Once you have these basics, investing in diversified index funds is a great next step!`;
                    }
                }
                
                if (msg.includes('debt') || msg.includes('loan') || msg.includes('credit')) {
                    return `For debt management, try the avalanche method: pay minimums on all debts, then extra on the highest interest rate debt. If that's overwhelming, try the snowball method (smallest balance first). Consider debt consolidation if you have good credit. Avoid new debt while paying off existing ones!`;
                }
                
                if (msg.includes('emergency') || msg.includes('fund')) {
                    const emergencyGoal = monthlyExpenses * 3;
                    return `Your emergency fund should be 3-6 months of expenses (${this.formatCurrency(emergencyGoal)} - ${this.formatCurrency(monthlyExpenses * 6)} based on your current spending). Keep this in a high-yield savings account. Start with $1000, then build to 1 month, then gradually to 3-6 months.`;
                }
                
                if (msg.includes('income') || msg.includes('earn') || msg.includes('money')) {
                    return `To increase income, consider: 1) Asking for a raise (prepare your case with achievements), 2) Developing in-demand skills through online courses, 3) Side hustles matching your skills, 4) Freelancing in your expertise area. Your current monthly income is ${this.formatCurrency(monthlyIncome)}.`;
                }

                if (msg.includes('food') || msg.includes('grocery') || msg.includes('restaurant')) {
                    const foodExpenses = this.getCategoryExpenses('Food');
                    return `Food expenses: ${this.formatCurrency(foodExpenses)}/month. To save: 1) Meal prep on Sundays, 2) Shop with a list, 3) Limit dining out to 2-3 times/week, 4) Cook in batches. Aim for 10-15% of income on food (${this.formatCurrency(monthlyIncome * 0.125)} for you).`;
                }

                // Default helpful response with user's financial context
                if (this.transactions.length > 0) {
                    return `Based on your financial data: Balance: ${this.formatCurrency(balance)}, Monthly Income: ${this.formatCurrency(monthlyIncome)}, Monthly Expenses: ${this.formatCurrency(monthlyExpenses)}. Your biggest expense category is ${topExpenseCategory}. What specific aspect of your finances would you like help with? I can provide advice on budgeting, saving, investing, or debt management.`;
                } else {
                    return `Hi! I'm your AI financial advisor. I can provide personalized advice once you add some transactions. For now, I can help with general questions about budgeting, saving, investing, or debt management. What would you like to know?`;
                }
            }

            getMonthlyIncome() {
                const thisMonth = new Date().toISOString().slice(0, 7);
                return this.transactions
                    .filter(t => t.type === 'income' && t.date.startsWith(thisMonth))
                    .reduce((sum, t) => sum + t.amount, 0);
            }

            getMonthlyExpenses() {
                const thisMonth = new Date().toISOString().slice(0, 7);
                return this.transactions
                    .filter(t => t.type === 'expense' && t.date.startsWith(thisMonth))
                    .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            }

            getTopExpenseCategory() {
                const expensesByCategory = {};
                this.transactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
                    });

                return Object.keys(expensesByCategory).reduce((a, b) => 
                    expensesByCategory[a] > expensesByCategory[b] ? a : b, 'Food');
            }

            getExpenseBreakdown() {
                const expensesByCategory = {};
                this.transactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + Math.abs(t.amount);
                    });
                return expensesByCategory;
            }

            getCategoryExpenses(category) {
                const thisMonth = new Date().toISOString().slice(0, 7);
                return this.transactions
                    .filter(t => t.type === 'expense' && t.category === category && t.date.startsWith(thisMonth))
                    .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            }

            addChatMessage(message, sender) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.innerHTML = `<strong>${sender === 'user' ? 'You' : 'AI Assistant'}:</strong><br>${message}`;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            generateInsights() {
                const insights = [];
                
                if (this.transactions.length === 0) {
                    insights.push({
                        title: 'Welcome to AI Finance Copilot!',
                        message: 'Start by adding your first transaction to get personalized AI insights.'
                    });
                } else {
                    const thisMonth = new Date().toISOString().slice(0, 7);
                    const monthlyExpenses = this.transactions
                        .filter(t => t.type === 'expense' && t.date.startsWith(thisMonth))
                        .reduce((sum, t) => sum + Math.abs(t.amount), 0);

                    const monthlyIncome = this.transactions
                        .filter(t => t.type === 'income' && t.date.startsWith(thisMonth))
                        .reduce((sum, t) => sum + t.amount, 0);

                    if (monthlyExpenses > 0) {
                        insights.push({
                            title: 'Monthly Spending Analysis',
                            message: `You've spent ${this.formatCurrency(monthlyExpenses)} this month.`
                        });
                    }

                    if (monthlyIncome > monthlyExpenses) {
                        insights.push({
                            title: 'Great Job! ðŸŽ‰',
                            message: `You're saving ${this.formatCurrency(monthlyIncome - monthlyExpenses)} this month.`
                        });
                    } else if (monthlyExpenses > monthlyIncome && monthlyIncome > 0) {
                        insights.push({
                            title: 'Budget Alert âš ï¸',
                            message: `You're spending more than you earn this month. Consider reviewing your expenses.`
                        });
                    }

                    insights.push({
                        title: 'AI Tip ðŸ¤–',
                        message: 'Ask me questions in the chat like "How can I save more?" or "What should I budget for food?"'
                    });
                }

                this.displayInsights(insights);
            }

            displayInsights(insights) {
                const container = document.getElementById('insightsList');
                container.innerHTML = insights.map(insight => `
                    <div class="insight-item">
                        <strong>${insight.title}</strong><br>
                        ${insight.message}
                    </div>
                `).join('');
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD'
                }).format(amount);
            }

            showNotification(message, type) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app');
            window.financeApp = new AIFinanceCopilot();
        });

        // Also initialize immediately in case DOM is already loaded
        if (document.readyState !== 'loading') {
            console.log('DOM already ready, initializing app immediately');
            window.financeApp = new AIFinanceCopilot();
        }
    </script>
</body>
</html>